#!/usr/bin/perl

use strict;
use warnings;
use File::Basename;
use Term::ANSIColor ;


my @files;
my $argc = @ARGV;
my $commits;
my $len;
my $clear;

$clear = `clear`;


sub hide_cursor {
    print "\033[?25l";
}

#
# # show cursor
#  #
#   
sub show_cursor {
    printf "\033[?25h";
    printf "\033[m\n";
    exit 1;
}

sub heading {
    print "\n";
    printf "  %-45s %-10s %s\n","file", "commits", "active days";
    print "\n";
}

sub active_days {
    my @log = `git log --pretty='format: %ai' @_ | cut -d ' ' -f 2 | uniq`;
    
    return @log;
}

sub effort {
    my $file;
    my $f_dot;
    my $dot = '.';  
    my $active;

    foreach $file (@files) {
        $commits= `git log --oneline $file | wc -l`;
        $len = length($file);

        $f_dot = $file;
        foreach  ($len .. 48) {
            $f_dot .= $dot;
        }
        printf "  %s %-10d ",$f_dot, $commits;
        $active = &active_days($file);
        printf "  %-10d \n", $active;
    }

}



if ($argc >= 1) {
    @files = @ARGV;
} else {
    @files = `git ls-files`;
}

chomp(@files);
print $clear;

&hide_cursor;
print color 'red';
&heading;

print color 'green';
&effort;
print color 'reset';
&show_cursor;
