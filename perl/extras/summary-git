#!/usr/bin/perl

use strict;
use warnings;
use File::Basename;

my $project;
my $path = `pwd`;
my $commit = '';

$project = basename($path);

sub repository_age {
    `git log --pretty=oneline --format="%ar" | tail -n1 | sed 's/ago/ /'`;
}

sub active_days {
    `git log --pretty='format %ai' | cut -d ' ' -f 2 | uniq | wc -l`;
}

sub commit_count{
    `git log --oneline $commit | wc -l`;
}

sub file_count {
    `git ls-files | wc -l`;
}

sub author {
    my @author = `git log --pretty='format:%an' | sort -r | uniq`;
    my @log =  `git shortlog -n -s $commit`; 
    my @commits;
    my $total = 0;
    my @tmp;
    my $i  = 0;


    chomp(@log);
    chomp(@author);
    foreach (@author) {
        $commits[$i++] = `git log --oneline --author=$_  | wc -l | tr -d ' '`;
    }

    @tmp= `git rev-list --all`;
    $total = @tmp;
    chomp(@commits);
    $i = 0;
    foreach (@commits) {
        printf "\e[36m\t%-15s %-d(%2.1f%%)\e[0m\n",
                           $author[$i], $commits[$i], 100 * $commits[$i]/$total;
        $i++;
    }
}

my $repo_age = &repository_age;
my $active_days = &active_days;
my $commit_count = &commit_count;
my $file_count = &file_count;

chomp($active_days);

print "\nproject  : $project";
print "repo age : $repo_age";
print "active   : \e[34m$active_days days\e[0m\n";
print "commits  : $commit_count";

$commit = shift @ARGV;
if (!defined $commit) {
    $commit = '';
    print "files    : $file_count";
}

print "\tAuthor\t\tCommits: \n";
&author;

